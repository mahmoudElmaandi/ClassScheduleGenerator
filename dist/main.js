(()=>{"use strict";function e(){GroupDiv.style.display="none","flex"==CourseDiv.style.display?CourseDiv.style.display="none":CourseDiv.style.display="flex",window.scrollTo(0,0),document.title="اختيار المواد"}function t({id:e,style:t,type:n,innerHTML:l,onclick:o,Eventtype:i}){let s=document.createElement("button");return s.setAttribute("id",e),s.setAttribute("style",t),s.type=n,s.innerHTML=l,null!=o&&("listener"==i?s.addEventListener("click",o):s.setAttribute("onclick",o)),s}let n={Eventtype:"listener",id:"chooseCourses",style:"display: block; margin: 5px auto;",type:"button",innerHTML:"اختيار المواد",onclick:function(){var n=Array.from(document.getElementById("CourseSelect").selectedOptions),o=document.getElementById("GroupSelect").options;let i=Array.from(document.querySelectorAll("#group-checkboxes input"));if(n.length<=0)window.alert("يرجى اختيار مادتين على الأقل");else{for(let e=0;e<o.length;e++)o[e].hidden=!0,o[e].selected=!1,i[e].parentElement.hidden=!0,i[e].parentElement.classList.remove("selected"),i[e].checked=!1;let s=n.map((e=>e.value));for(let e=0;e<s.length;e++)codesmap[s[e]].forEach((e=>{o[e].hidden=!1,o[e].selected=!1,i[e].parentElement.hidden=!1,i[e].checked=!1}));document.getElementById("group-selectall").checked=!1,function(){if(GroupDiv.style.display="flex",CourseDiv.style.display="none",null==document.getElementById("ChangeC")){let n=t(l);n.addEventListener("click",e),HeaderD.insertBefore(n,document.querySelector("#unselectAll"))}document.title="اختيار المجموعات"}()}window.scrollBy(0,120)}},l={Eventtype:"listener",id:"ChangeC",style:"display: block; margin: 5px auto;",type:"button",innerHTML:"تغيير المواد"},o={id:"printCombination",style:"display: block; margin: 5px auto;",type:"submit",innerHTML:"اطبع الاحتمالات"};function i(e){var t=e.trim().split("\n");let n={},l=[];for(let e=0;e<t.length;e++){let l=t[e].split(";")[3];if(null!=n[l]){let t=n[l];t.push(e),n[l]=t}else n[l]=[e]}let o=Object.keys(n);for(let e=0;e<o.length;e++){let i=n[o[e]],s=[],c={};i.forEach(((e,n)=>{let l=t[e].split(";"),o=l[1],i=l[2],r=l[4],a=l[3],d=l[0],u=l[5];0==n&&(c.ccname=d,c.ccode=a,c.unit=u,c.deparment="CS",c.year="2021"),s.push({gnumber:o,gtimes:r,glecturer:i})})),c.groups=s,l.push(c)}return l}function s(e){let{ScheduleTextFormat:t,ScheduleTimes:n}=function(e){let t="",n="";return e.split(",").forEach((e=>{t+=allGroups[e].name+" [ "+allGroups[e].dr+" ] <br> ",n=n+allGroups[e].time+","})),{ScheduleTextFormat:t,ScheduleTimes:n}}(e),l=b(n,!0);l=l+"<br>"+t,tableInfo.style.display="block",tableInfo.innerHTML=l;var o=document.getElementsByClassName("celly");for(let e=0;e<o.length;e++)o[e].textContent="";e.split(",").forEach((e=>{allGroups[e].time.split(",").forEach((t=>{let n=`<span id='courseName'> ${allGroups[e].name}</span>`,l=`<span id='drName'> ${allGroups[e].dr}</span>`;o[TableCellsMap.get(t)].innerHTML=n+"<br>"+l}))}))}function c(e){const t=e.target;var n=document.getElementsByClassName(t.id)[0],l=n.selectedIndex;let o=Array.from(n.options);if("next"==t.className){if(l<=n.options.length-1){let e=o.filter((e=>0==e.hidden&&e.index>l))[0];if(null!=e){e.selected="selected",s(e.value);let n=document.querySelector(`#${t.id}[class="previous"]`);n.disabled&&(n.style.cursor="pointer",n.disabled=!1)}else t.style.cursor="not-allowed",t.disabled=!0}}else if(l<=0)t.style.cursor="not-allowed",t.disabled=!0;else{let e=o.filter((e=>0==e.hidden&&e.index<l)),n=e[e.length-1];if(null!=n){n.selected="selected",s(n.value);let e=document.querySelector(`#${t.id}[class="next"]`);e.disabled&&(e.style.cursor="pointer",e.disabled=!1)}else t.style.cursor="not-allowed",t.disabled=!0}}function r(e){let t=document.querySelector(`#${e}[class="next"]`),n=document.querySelector(`#${e}[class="previous"]`);t.style.cursor="pointer",t.disabled=!1,n.style.cursor="pointer",n.disabled=!1}function a(e){let t=e.target;t.style.backgroundColor="#41b53f";const n=t.value.split(","),l=t.getAttribute("selectclass");u(l,t.getAttribute("key")),r(l);let o=document.querySelector(`.${l}`),i=Array.from(o.options);i.forEach((e=>e.hidden=!0)),n.forEach((e=>{i[e].hidden=!1})),o.selectedIndex=n[0],s(o.options[n[0]].value)}function d(e){let t=e.target;t.style.backgroundColor="#41b53f";const n=t.getAttribute("selectclass");u(n,t.getAttribute("key")),r(n);let l=document.querySelector(`.${n}`),o=Array.from(l.options);o.forEach((e=>{e.hidden=!1})),o[0].selected="selected",s(o[0].value)}function u(e,t){document.querySelectorAll(`[selectclass="${e}"]`).forEach((e=>{e.getAttribute("key")!=t&&(e.style.backgroundColor="#3f51b5")})),"all"!=t&&(document.querySelector("#fullAttendancebtn").style.backgroundColor="#3f51b5")}function m(){failedTestDiv.innerHTML="";const e=Array.from(document.getElementById("GroupSelect").selectedOptions),t=new Map;if(coursesTimes=[],courseGroupsIndexes=[],totalNoUnits=0,0==e.length)window.alert("يرجى اختيار مجموعة واحدة على الأقل"),h();else if(e.forEach((e=>{const n=e.value,l=e.getAttribute("unit"),o=e.getAttribute("time"),i=e.index;if(t.has(n)){let e=t.get(n);coursesTimes[e].push(o),courseGroupsIndexes[e].push(i)}else{const e=coursesTimes.length;t.set(n,e),coursesTimes.push([o]),courseGroupsIndexes.push([i]),totalNoUnits+=parseInt(l)}})),0==t.size)window.alert("يرجى اختيار مادتين مختلفتين على الأقل"),h();else{const e=document.getElementById("printCombination");e.disabled=!0,e.innerHTML=" ..... جاري طباعة الاحتمالات",document.querySelector("#isFailingStu").checked||totalNoUnits<=unitLimit?(setTimeout((()=>{!function(){const e=function(){let e=1;for(let t=0;t<coursesTimes.length;t++)e*=coursesTimes[t].length;return e}();e<CombinationLimit?(numresult=p(coursesTimes),textresult=p(courseGroupsIndexes),function(){for(var e=0;e<numresult.length;e++){const t=numresult[e].split(",");function n(){const e=t.length;for(let n=0;n<e;n++)for(let l=n+1;l<e;l++)if(t[n]==t[l])return!0;return!1}0==n()&&nooverlapcombintion.push(e)}0==nooverlapcombintion.length?y(" عدد الاحتمالات  "+textresult.length+"&#10;  الناجحة منها "+nooverlapcombintion.length+" هناك تداخل في مواعيد المواد المختارة "):(function(){if(1==TestID)var e=document.createElement("div");else e=document.getElementsByName("CombinationTestsContainer")[0];e.setAttribute("name","CombinationTestsContainer"),e.setAttribute("class","CombinationTestsContainer"),form.appendChild(e);var t=document.createElement("div");t.setAttribute("class","CombinationTestDiv"),t.setAttribute("id",TestID),e.appendChild(t);var n=document.createElement("button");n.type="button",n.setAttribute("name",TestID),n.setAttribute("class","collapsible active"),n.innerHTML=" المحاولة "+TestID,n.addEventListener("click",f),t.appendChild(n);var l=document.createElement("div");l.setAttribute("class","CombinationResultContainer"),l.setAttribute("id","ResultContainer"+TestID),l.style.display="block";var o=document.createElement("P");o.setAttribute("id","TestSummary");const i=" عدد الاحتمالات  "+textresult.length+" |  الناجحة منها "+nooverlapcombintion.length+" |  عدد الواحدات المسجلة "+totalNoUnits;o.innerHTML=i,l.appendChild(o),t.appendChild(l);var u=document.createElement("button");u.type="button",u.setAttribute("class",TestID),u.setAttribute("id","deleteCombinationTestBtn"),u.addEventListener("click",(function(){form.children[2].removeChild(document.getElementById(this.className)),0==document.getElementsByClassName("CombinationTestDiv").length&&(ScheduleDiv.style.display="none",Schedule.style.display="none",document.getElementById("tableInfo").style.display="none")})),u.innerHTML="حذف",l.appendChild(u);var m=document.createElement("button");m.type="button",m.setAttribute("id","hideCombinationTestBtn"),m.addEventListener("click",(function(){this.parentElement.parentElement.children[0].click()})),m.innerHTML="إخفاء",l.appendChild(m),Schedule.style.display="inline-table",ScheduleDiv.style.display="block",ScheduleDiv.style.display="block",ScheduleDiv.style.height="1000px",function(){let e=document.createElement("div");e.setAttribute("id","attendanceDiv"),e.setAttribute("class","attendanceDiv"+selectTableNum),l.appendChild(e);var t=document.createElement("select");t.setAttribute("id","TableSelectT"),t.setAttribute("class","TableSelectT"+selectTableNum),t.addEventListener("change",(e=>{s(e.target.value),r(e.target.className)}));for(var n=0;n<nooverlapcombintion.length;n++){let e=n+1;var o=document.createElement("option");o.innerHTML=e,o.value=textresult[nooverlapcombintion[n]],t.appendChild(o);let l=b(numresult[nooverlapcombintion[n]]);if(l<5)if(attendanceDaysMap.has(l)){let e=Array.from(attendanceDaysMap.get(l)).concat([n]);attendanceDaysMap.set(l,e)}else attendanceDaysMap.set(l,[n])}!function(e){let t=document.querySelector(".attendanceDiv"+selectTableNum);t.innerHTML="عدد أيام الحضور : عدد الاحتمالات <br>";var n=document.createElement("button");n.type="button",n.setAttribute("id","fullAttendancebtn"),n.setAttribute("key","all"),n.setAttribute("selectclass","TableSelectT"+selectTableNum),n.addEventListener("click",d),n.style.backgroundColor="#41b53f",n.innerHTML=`كل الاحتمالات : ${nooverlapcombintion.length}`,t.appendChild(n);for(let[n,o]of e){var l=document.createElement("button");l.type="button",l.setAttribute("id","attendancebtn"),l.setAttribute("key",n),l.setAttribute("value",o),l.setAttribute("selectclass","TableSelectT"+selectTableNum),l.addEventListener("click",a);let e=o.length;l.innerHTML=`${n} : ${e}`,t.appendChild(l)}}(attendanceDaysMap),s(t.options[0].value);var i=document.createElement("button");i.setAttribute("type","button"),i.setAttribute("id","TableSelectT"+selectTableNum),i.setAttribute("class","previous"),i.addEventListener("click",c),i.innerHTML="&#10094;";var u=document.createElement("button");u.setAttribute("type","button"),u.setAttribute("id","TableSelectT"+selectTableNum),u.setAttribute("class","next"),u.addEventListener("click",c),u.innerHTML="&#10095;",l.appendChild(i),l.appendChild(t),l.appendChild(u)}()}(),TestID+=1,selectTableNum+=1)}()):y(" عدد الاحتمالات  "+e+"&#10;وقد تخطت الحد المسموح")}(),h()}),20),document.title="تصفح الجداول"):(y(" عدد الواحدات  "+totalNoUnits+"&#10;وقد تخطت الحد المسموح 20"),h())}}function p(e){if(0===e.length)return[];if(1===e.length)return e[0];var t=[],n=p(e.slice(1));for(var l in n)for(var o=0;o<e[0].length;o++)t.push(e[0][o]+","+n[l]);return t}function b(e,t){var n=[11,21,31,41,51],l=[18,28,38,48,58],o=0,i="",s=[];let c=e.split(",");for(var r=0;r<n.length;r++)for(var a=0;a<c.length;a++){const e=c[a];if(""!=e&&e>=n[r]&&e<=l[r]){o+=1;break}a==c.length-1&&s.push(r+1)}if(i="الحضور:"+o,0!=s.length)for(i+="&#10;الاجازة:",a=0;a<s.length;a++)switch(s[a]){case 1:i+="السبت ";break;case 2:i+=" الاحد ";break;case 3:i+=" الاثنين ";break;case 4:i+=" الثلاثاء ";break;case 6:i+=" الخميس ";break;case 5:i+=" الاربعاء "}return t?i:o}function h(){var e;coursesTimes=[],courseGroupsIndexes=[],nooverlapcombintion=[],numresult=[],textresult=[],totalNoUnits=0,attendanceDaysMap=new Map,null!=document.getElementsByName("CombinationTestsContainer")[0]&&(e=TestID-1,Array.from(document.getElementsByName("CombinationTestsContainer")[0].children).forEach((t=>{t.children[0].name==e||t.children[0].classList.contains("active")&&t.children[0].click()})));const t=document.getElementById("printCombination");t.disabled=!1,t.innerHTML="اطبع الاحتمالات"}function y(e){if(1==TestID){var t=document.createElement("div");t.setAttribute("name","CombinationTestsContainer"),t.setAttribute("class","CombinationTestsContainer"),form.appendChild(t)}var n=document.createElement("div");n.setAttribute("id",TestID),n.innerHTML=e;var l=document.createElement("button");l.type="button",l.setAttribute("class",TestID),l.setAttribute("id","Specdelbtn"),l.innerHTML=" حذف المحاولة الفاشلة "+TestID,failedTestDiv.appendChild(n),failedTestDiv.appendChild(l),l.setAttribute("onclick","failedTestDiv.removeChild(document.getElementById(this.className));failedTestDiv.removeChild(document.getElementsByClassName(this.className)[0]);"),TestID+=1,window.scrollBy(0,250)}function f(e){let t=e.target;var n=document.getElementById("ResultContainer"+t.name);t.classList.contains("active")?t.classList.remove("active"):t.classList.toggle("active"),"block"==n.style.display?n.style.display="none":n.style.display="block"}const v=document.getElementById("inputfile"),g=document.querySelector("#fileSelect");v.addEventListener("change",(function(){const e=this.files[0];if(["text/plain","application/vnd.ms-excel","application/json","text/csv"].includes(e.type)){console.log(e);var t=new FileReader;t.readAsText(e),t.onload=function(t){!function(e,t){let n;"application/json"==t?n=JSON.parse(e):(e.endsWith(";")&&(e=e.slice(0,e.length-1)),n=i(e)),E(n)}(t.target.result,e.type)}}else console.log(e),console.log("Not a Valid type")}),!1),g.addEventListener("click",(()=>{v&&v.click()}),!1);let C=document.getElementById("Dep");C.addEventListener("change",(function(e){const t=C.options[C.selectedIndex].value;validDepValues.includes(t)&&E(i(window.coursesInfo[t]))}));let T=[],w=[];function E(e){for(let l=0;l<e.length;l++){const{ccname:i,ccode:s,groups:c,unit:r}=e[l];function a(e,t){return Array(t-e+1).fill().map(((t,n)=>e+n))}T.push({name:i,code:s}),codesmap[s]=a(w.length,w.length+c.length-1);for(let d=0;d<c.length;d++){const{glecturer:u,gnumber:p,gtimes:b}=c[d];w.push({dr:u,time:b,regcode:`${s} ${p}`,name:`${i} ${p}`,optionName:`${i} ${p} ${u}`,code:s,unit:r})}}allGroups=w,function(){document.querySelector("#home-screen").style.display="none";let e=t(n);(function(e){var t=document.createElement("select");t.setAttribute("multiple","true"),t.id="CourseSelect";var n=document.createElement("div");n.id="course-checkboxes",n.className="select-checkboxes";for(let l=0;l<e.length;l++){const{name:o,code:i}=e[l];let s=document.createElement("option");s.innerHTML=o,s.value=i,t.appendChild(s);const c=A(o,l,"course");n.appendChild(c)}const l=D("تحديد كل المواد","course");CourseDiv.appendChild(t),CourseDiv.appendChild(l),CourseDiv.appendChild(n)})(T),CourseDiv.appendChild(e),GroupDiv.appendChild(HeaderD),function(e){var t=document.createElement("select");t.id="GroupSelect",t.setAttribute("multiple","true");var n=document.createElement("div");n.id="group-checkboxes",n.className="select-checkboxes";for(let o=0;o<e.length;o++){const{dr:i,time:s,regcode:c,name:r,optionName:a,code:d,unit:u}=e[o];var l=document.createElement("option");l.innerHTML=a,l.value=d,l.setAttribute("time",s),l.setAttribute("unit",u),l.setAttribute("regCode",c),delete e[o].optionName,delete e[o].code,delete e[o].regcode,delete e[o].unit,t.appendChild(l);const m=A(r+" "+i,o,"group");n.appendChild(m)}const o=D("تحديد كل المجموعات","group");GroupDiv.appendChild(t),GroupDiv.appendChild(o),GroupDiv.appendChild(n)}(w),form.appendChild(CourseDiv),form.appendChild(GroupDiv),CourseDiv.style.display="flex",GroupDiv.style.display="none";var l=document.createElement("div");l.setAttribute("id","submitcomb");let i=t(o);GroupDiv.appendChild(l),l.appendChild(i),form.addEventListener("submit",m),document.title="اختيار المواد"}()}function A(e,t,n){let l=document.createElement("label");l.setAttribute("for",`${n}${t}`),l.setAttribute("class","checkbox-label"),l.innerText=e;let o=document.createElement("input");return o.setAttribute("type","checkbox"),o.setAttribute("index",t),o.setAttribute("id",`${n}${t}`),o.setAttribute("class","checkbox-input"),o.addEventListener("click",(e=>{k(e.target)})),l.appendChild(o),l}function k(e){const t=e.id.includes("group")?"GroupSelect":"CourseSelect";console.log(e.getAttribute("id"));const n=Array.from(document.querySelector(`#${t}`).options);console.log(e.getAttribute("index"));const l=e.getAttribute("index");e.checked?(n[l].selected=!0,e.parentElement.classList.add("selected")):(n[l].selected=!1,e.parentElement.classList.remove("selected"))}function D(e,t){let n=document.createElement("label");n.setAttribute("for",`${t}-selectall`),n.setAttribute("class","select-all-checkbox"),n.innerText=e;let l=document.createElement("input");return l.setAttribute("type","checkbox"),l.setAttribute("id",`${t}-selectall`),l.setAttribute("class","select-all-checkbox-input"),l.addEventListener("click",(()=>{!function(e){console.log("clicked"),console.log("type",e);let t=Array.from(document.querySelectorAll(`#${e}-checkboxes input`));const n=document.querySelector(`#${e}-selectall`);console.log("checkboxes",t),t.forEach((e=>{0==e.parentElement.hidden&&(n.checked?(console.log("selectAllCheckbox is checked"),console.log("selectAllCheckbox.checked",n.checked),e.checked=!0,k(e)):(console.log(" selectAllCheckbox not checked"),e.checked=!1,k(e)))}))}(t)})),n.appendChild(l),n}window.form=document.getElementById("zero"),window.CombinationLimit=16e7,window.unitLimit=20;const x=async(e="cs")=>{const t=await fetch(`https://calm-gray-yak-toga.cyclic.app/latest-courses-file?filter=${e}`);return await t.json()};(async()=>{document.querySelector("#invalidMessages").innerHTML+=' <div class="form-check">\n    <input class="form-check-input" type="checkbox" style="float: none;margin: 0px;" value="" id="isFailingStu">\n    <label class="form-check-label" for="flexCheckDefault">\n     هل أنت طالب متعثر؟ قم بالتحديد لإلغاء حد الـ 20 وحدة\n    </label>\n    </div>',window.coursesInfo={},window.validDepValues=[];const e=document.querySelector("#files-sec"),t=document.querySelector(".form-select");t.disabled=!0;const n={cs:"علوم حاسب لائحة قديمة","new-cs":"علوم حاسب لائحة جديدة"};function l(t){const{content:l,description:o,filter:i}=t;l&&(window.coursesInfo[i]=l,window.validDepValues.push(i),o&&(document.querySelector("#header-note").innerHTML+=`${n[i]} :  ${o} <br>`),function({name:t,content:n,department:l,term:o,createdAt:i}){e.innerHTML+=` \n        <tr  >\n         <th scope="row">${l} </th>\n         <td>${o}</td>\n         <td>${new Date(i).toLocaleString()}</td>\n         <td><button onclick="window.downloadCSV(this)" name="${t}" content= "${n}">  <i class="bi bi-download"></i></button>\n         </td>\n        </tr>\n       `}(t))}l(await x());const o=await x("new-cs");let{content:i}=o;i&&(l(o),t.appendChild(function({department:e,filter:t}){const n=document.createElement("option");return n.innerHTML=e,n.value=t,n}(o))),t.disabled=!1})(),window.codesmap=new Map,window.allGroups=[],window.GroupDiv=document.createElement("div"),window.GroupDiv.id="GroupSelector",window.CourseDiv=document.createElement("div"),window.CourseDiv.id="CourseSelector",window.HeaderD=document.createElement("div"),window.tableInfo=document.getElementById("tableInfo"),window.failedTestDiv=document.getElementById("failed"),window.attendanceDaysMap=new Map,window.totalNoUnits=0,window.coursesTimes=[],window.courseGroupsIndexes=[],window.numresult=[],window.textresult=[],window.nooverlapcombintion=[],window.TestID=1,window.selectTableNum=1,window.TableCellsMap=new Map;for(let e=0;e<document.getElementsByClassName("celly").length;e++)TableCellsMap.set(document.getElementsByClassName("celly")[e].textContent,e);document.querySelector("#printSchedule").addEventListener("click",(function(){window.print()})),function(){const e=document.querySelector("#Schedule"),t=document.querySelector("#ScheduleDiv");window.addEventListener("beforeprint",(function(n){document.body.style.visibility="hidden",e.style.visibility="visible",e.style.top=0,e.style.left=0,e.style.position="absolute",e.style.padding="30px",t.style.height="0px"})),window.addEventListener("afterprint",(n=>{document.body.style.visibility="visible",e.style.position="inherit",e.style.top="inherit",e.style.left="inherit",e.style.padding="0px",t.style.height="1000px"}))}(),window.downloadCSV=function(e){console.log(e);let t=e.getAttribute("content");if(!t)return;let n=e.getAttribute("name");t=t.replace(/\n/g,"\r\n");var l=new Blob([t],{type:"text/plain"}),o=document.createElement("a");o.download=`${n}.csv`,o.href=window.URL.createObjectURL(l),o.target="_blank",o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}})();